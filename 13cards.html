<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Tiến Lên - Mẫu</title>
    <!-- Tailwind CSS for rapid UI development -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts for a modern, clean look -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
        /* Reusing the theme from the main page for consistency */
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #0d0e1b;
            color: #e0e0e0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            overflow: hidden; /* Prevent scrolling */
        }

        .bg-primary { background-color: #1a1c33; }
        .bg-secondary { background-color: #2a2d4e; }
        .text-accent { color: #ffc400; }
        .border-accent { border-color: #ffc400; }

        .btn-gradient {
            background-image: linear-gradient(to right, #ffc400 0%, #ff8a00 51%, #ffc400 100%);
            background-size: 200% auto;
            transition: all 0.3s ease-out;
            color: #1a1c33;
            font-weight: 700;
            border-radius: 8px;
            box-shadow: 0 4px 15px 0 rgba(255, 196, 0, 0.3);
        }
        .btn-gradient:hover {
            background-position: right center;
            box-shadow: 0 6px 20px 0 rgba(255, 196, 0, 0.5);
            transform: translateY(-2px);
        }
        .btn-gradient:disabled {
            background-image: none; background-color: #555; color: #999;
            cursor: not-allowed; transform: none; box-shadow: none;
        }
        
        /* --- Card Game Specific Styles --- */
        .game-table {
            background: radial-gradient(circle, #2a4b37 0%, #1a3525 100%);
            border: 8px solid #5a3a22;
            width: 100%;
            height: 100%;
            position: relative;
            overflow: hidden; /* Ensure pseudo-element is contained */
        }
        
        .table-logo {
            content: 'Greenwich88.bet';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-25deg);
            font-size: 8vw; /* Responsive font size */
            font-weight: 900;
            color: rgba(255, 255, 255, 0.2); /* Very transparent white */
            z-index: 0;
            pointer-events: none; /* Not interactive */
            white-space: nowrap; /* Prevent text wrapping */
        }
        .table-logo span {
            color: rgba(255, 196, 0, 0.27); /* Yellow, slightly more opaque */
        }

        .player-hand {
            display: flex;
            justify-content: center;
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 80%;
        }

        .play-area {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            gap: -20px; /* Overlap cards */
            min-height: 120px;
        }

        .card {
            background-color: white;
            color: black;
            border: 1px solid #555;
            border-radius: 8px;
            width: 80px;
            height: 112px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 4px;
            font-size: 1.5rem;
            font-weight: 700;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.3);
            cursor: pointer;
            transition: transform 0.2s ease-out, margin-bottom 0.2s ease-out;
            user-select: none;
        }
        
        .player-hand .card {
            margin-left: -40px; /* Overlap cards in hand */
        }
        .player-hand .card:hover {
            transform: translateY(-20px);
        }
        .player-hand .card.selected {
            transform: translateY(-30px);
            border: 3px solid #ffc400;
        }

        .suit-♥, .suit-♦ { color: #d90429; }
        .suit-♣, .suit-♠ { color: #000; }
        
        .card .suit { font-size: 1.2rem; }
        .card .rank-bottom { transform: rotate(180deg); }

        .opponent-hand {
            display: flex;
            position: absolute;
            align-items: center;
        }
        .opponent-hand .card {
             background: linear-gradient(135deg, #d90429, #8c031a);
             color: transparent;
        }
        #opponent-top { top: 20px; left: 50%; transform: translateX(-50%); }
        #opponent-top .card { margin-left: -50px; }
        
        #game-controls {
            position: absolute;
            bottom: 150px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10;
        }

        #home-btn {
            position: absolute;
            top: 2rem;
            left: 2rem;
            z-index: 15;
            background-color: #1a1c33;
            color: #ffc400;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 700;
            text-decoration: none;
            border: 2px solid #ffc400;
            transition: all 0.3s ease-out;
            box-shadow: 0 2px 5px rgba(0,0,0,0.4);
            z-index: 21;
        }

        #home-btn:hover {
            background-color: #ffc400;
            color: #1a1c33;
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(255, 196, 0, 0.3);
            
        }
        
        .overlay {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 20;
            backdrop-filter: blur(5px);
        }
        
        .modal-box {
            background-color: #1a1c33;
            padding: 2rem;
            border-radius: 10px;
            border: 2px solid #ffc400;
            text-align: center;
            box-shadow: 0 10px 25px rgba(0,0,0,0.5);
        }
        .modal-box p {
            font-size: 1.25rem;
            margin-bottom: 1.5rem;
        }
        .modal-box input {
            background-color: #0d0e1b;
            border: 1px solid #ffc400;
            color: #e0e0e0;
            text-align: center;
            font-size: 1.5rem;
            padding: 0.5rem;
            border-radius: 5px;
            width: 100%;
        }

    </style>
</head>
<body class="bg-primary">
    <main class="w-screen h-screen p-4">
        <a href="188bet.html" id="home-btn">Về Trang Chủ</a>
        <div class="game-table rounded-2xl">
            <div class="table-logo"><span>Greenwich88</span>.bet</div>
            
            <!-- Game Over Screen -->
            <div id="game-over-overlay" class="overlay hidden">
                <div class="modal-box">
                    <h2 id="winner-message" class="text-5xl font-bold text-accent mb-8">Bạn đã thắng!</h2>
                    <button id="new-game-btn" class="btn-gradient text-2xl py-4 px-8">Chơi ván mới</button>
                </div>
            </div>
            
            <!-- Custom Alert Modal -->
            <div id="custom-alert-overlay" class="overlay hidden">
                <div class="modal-box">
                    <p id="custom-alert-message" class="text-white"></p>
                    <button id="custom-alert-ok-btn" class="btn-gradient py-2 px-8 mt-4">OK</button>
                </div>
            </div>

            <!-- Betting Modal -->
            <div id="betting-overlay" class="overlay hidden">
                <div class="modal-box w-full max-w-sm">
                    <h2 class="text-3xl font-bold text-accent mb-4">Đặt Cược</h2>
                    <p>Số dư của bạn: <span id="betting-balance" class="font-bold"></span></p>
                    <input type="number" id="bet-amount-input" placeholder="Nhập số tiền cược" class="mb-6">
                    <button id="place-bet-btn" class="btn-gradient text-xl py-3 w-full">Bắt Đầu Chơi</button>
                </div>
            </div>

            <!-- Opponent Hands -->
            <div id="opponent-top" class="opponent-hand">
                <div id="opponent-card-count" class="bg-black/50 p-2 rounded-lg text-lg font-bold mr-4">13 lá</div>
            </div>

            <!-- Center Play Area -->
            <div id="play-area" class="play-area"></div>

            <!-- Player's Hand -->
            <div id="player-hand" class="player-hand"></div>
            
            <!-- Player Action Controls -->
            <div id="game-controls" class="flex items-center gap-4 p-4 bg-black/30 rounded-lg">
                <button id="sort-btn" class="bg-blue-800 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg">Sắp Xếp</button>
                <button id="play-btn" class="btn-gradient text-xl font-bold py-3 px-10 rounded-lg">Đánh Bài</button>
                <button id="pass-btn" class="bg-red-800 hover:bg-red-700 text-white font-bold py-3 px-6 rounded-lg">Bỏ Lượt</button>
            </div>
             <div id="game-info" class="absolute top-4 right-4 bg-black/30 p-3 rounded text-right">
                <div class="font-bold">Số dư: <span id="player-balance" class="text-accent"></span></div>
                <div id="turn-indicator" class="text-accent font-bold text-xl mt-2">Lượt của: <span id="current-player">Bạn</span></div>
                <div id="last-action" class="text-sm text-gray-300 mt-1"></div>
            </div>
        </div>
    </main>
    
    <script>
        // --- GAME CONFIG ---
        const SUITS = { '♥': 'hearts', '♦': 'diamonds', '♣': 'clubs', '♠': 'spades' };
        const RANKS = ['3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A', '2'];
        const RANK_VALUES = {'3': 1, '4': 2, '5': 3, '6': 4, '7': 5, '8': 6, '9': 7, '10': 8, 'J': 9, 'Q': 10, 'K': 11, 'A': 12, '2': 13};
        const SUIT_VALUES = { 'spades': 1, 'clubs': 2, 'diamonds': 3, 'hearts': 4 };

        // --- GAME STATE ---
        let playerHand = [], dealerHand = [], selectedCards = [], lastPlayedHand = [];
        let currentPlayer = 'player', consecutivePasses = 0, gameOver = false;
        let balance = 1250000;
        let currentBet = 0;

        // --- DOM ELEMENTS ---
        const playerHandEl = document.getElementById('player-hand');
        const playAreaEl = document.getElementById('play-area');
        const opponentTopEl = document.getElementById('opponent-top');
        const playBtn = document.getElementById('play-btn');
        const passBtn = document.getElementById('pass-btn');
        const sortBtn = document.getElementById('sort-btn');
        const turnIndicator = document.getElementById('current-player');
        const lastActionEl = document.getElementById('last-action');
        const gameOverOverlay = document.getElementById('game-over-overlay');
        const winnerMessageEl = document.getElementById('winner-message');
        const newGameBtn = document.getElementById('new-game-btn');
        const customAlertOverlay = document.getElementById('custom-alert-overlay');
        const customAlertMessage = document.getElementById('custom-alert-message');
        const customAlertOkBtn = document.getElementById('custom-alert-ok-btn');
        const bettingOverlay = document.getElementById('betting-overlay');
        const bettingBalanceEl = document.getElementById('betting-balance');
        const betAmountInput = document.getElementById('bet-amount-input');
        const placeBetBtn = document.getElementById('place-bet-btn');
        const playerBalanceEl = document.getElementById('player-balance');
        
        // --- CARD & DECK LOGIC ---
        const getCardValue = (card) => (RANK_VALUES[card.rank] * 10) + SUIT_VALUES[SUITS[card.suit]];
        function createDeck() { const deck = []; for (const suit of Object.keys(SUITS)) { for (const rank of RANKS) { deck.push({ rank, suit, value: getCardValue({rank, suit}) }); } } return deck; }
        function shuffleDeck(deck) { for (let i = deck.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [deck[i], deck[j]] = [deck[j], deck[i]]; } }
        function dealCards(deck) { playerHand = []; dealerHand = []; for (let i = 0; i < 13; i++) { playerHand.push(deck.pop()); dealerHand.push(deck.pop()); } }
        function sortHand(hand) { hand.sort((a, b) => a.value - b.value); }

        // --- RENDERING & UI ---
        function formatCurrency(value) { return value.toLocaleString('vi-VN') + 'đ'; }
        function updateBalanceUI() { playerBalanceEl.textContent = formatCurrency(balance); bettingBalanceEl.textContent = formatCurrency(balance); }
        function createCardElement(card, isPlayerCard = false) { const cardEl = document.createElement('div'); cardEl.className = `card suit-${card.suit}`; cardEl.innerHTML = `<div class="rank-top"><div>${card.rank}</div><div class="suit">${card.suit}</div></div><div class="rank-bottom"><div>${card.rank}</div><div class="suit">${card.suit}</div></div>`; cardEl.cardData = card; if (isPlayerCard) cardEl.addEventListener('click', () => handleCardClick(cardEl, card)); return cardEl; }
        function renderHand() { playerHandEl.innerHTML = ''; playerHand.forEach(card => { playerHandEl.appendChild(createCardElement(card, true)); }); Array.from(playerHandEl.children).forEach(el => { if (selectedCards.some(sc => sc.value === el.cardData.value)) { el.classList.add('selected'); } }); }
        function renderOpponentHand() { opponentTopEl.innerHTML = `<div id="opponent-card-count" class="bg-black/50 p-2 rounded-lg text-lg font-bold mr-4">${dealerHand.length} lá</div>`; for(let i = 0; i < dealerHand.length; i++) { const cardEl = document.createElement('div'); cardEl.className = 'card face-down'; opponentTopEl.appendChild(cardEl); } }
        function renderPlayArea(cards) { playAreaEl.innerHTML = ''; cards.forEach(card => { const cardEl = createCardElement(card, false); cardEl.style.cursor = 'default'; playAreaEl.appendChild(cardEl); }); }
        function showAlert(message) { customAlertMessage.textContent = message; customAlertOverlay.classList.remove('hidden'); }
        function showBettingModal() { updateBalanceUI(); bettingOverlay.classList.remove('hidden'); betAmountInput.value = ''; }

        // --- GAME VALIDATION LOGIC ---
        function getHandType(hand) { if (hand.length === 0) return { type: 'invalid' }; const n = hand.length; sortHand(hand); const ranks = hand.map(c => RANK_VALUES[c.rank]); const values = hand.map(c => c.value); if (n === 1) return { type: 'single', value: values[0] }; if (n === 2 && ranks[0] === ranks[1]) return { type: 'pair', value: values[1] }; if (n === 3 && ranks[0] === ranks[1] && ranks[1] === ranks[2]) return { type: 'triple', value: values[2] }; if (n === 4 && ranks[0] === ranks[1] && ranks[1] === ranks[2] && ranks[2] === ranks[3]) return { type: 'four_of_a_kind', value: values[3] }; if (n >= 3) { let isStraight = !ranks.includes(RANK_VALUES['2']); if (isStraight) { for (let i = 0; i < n - 1; i++) { if (ranks[i+1] - ranks[i] !== 1) { isStraight = false; break; } } } if (isStraight) return { type: 'straight', value: values[n-1], length: n }; } return { type: 'invalid' }; }
        function isValidPlay(play, lastPlay) { const playType = getHandType(play); if (playType.type === 'invalid') return false; if (lastPlay.length === 0) return true; const lastPlayType = getHandType(lastPlay); if (playType.type === 'four_of_a_kind') { if (lastPlayType.type === 'single' && lastPlay[0].rank === '2') return true; if (lastPlayType.type === 'four_of_a_kind' && playType.value > lastPlayType.value) return true; return false; } if (lastPlayType.type === 'four_of_a_kind') return false; return playType.type === lastPlayType.type && play.length === lastPlay.length && playType.value > lastPlayType.value; }

        // --- AI LOGIC ---
        function findDealerPlay() { sortHand(dealerHand); let possiblePlays = []; for (let i = 0; i < dealerHand.length; i++) { possiblePlays.push([dealerHand[i]]); if (i < dealerHand.length - 1 && dealerHand[i].rank === dealerHand[i+1].rank) possiblePlays.push([dealerHand[i], dealerHand[i+1]]); if (i < dealerHand.length - 2 && dealerHand[i].rank === dealerHand[i+1].rank && dealerHand[i+1].rank === dealerHand[i+2].rank) possiblePlays.push([dealerHand[i], dealerHand[i+1], dealerHand[i+2]]); if (i < dealerHand.length - 3 && dealerHand[i].rank === dealerHand[i+1].rank && dealerHand[i+1].rank === dealerHand[i+2].rank && dealerHand[i+2].rank === dealerHand[i+3].rank) possiblePlays.push([dealerHand[i], dealerHand[i+1], dealerHand[i+2], dealerHand[i+3]]); } const uniqueRankCards = dealerHand.filter((c, i, a) => i === a.findIndex(card => card.rank === c.rank)); if (uniqueRankCards.length >= 3) { for (let i = 0; i <= uniqueRankCards.length - 3; i++) { for (let len = 3; len <= uniqueRankCards.length - i; len++) { const potential = uniqueRankCards.slice(i, i + len); const hand = getHandType(potential); if(hand.type === 'straight') { const actualStraight = potential.map(rankCard => dealerHand.find(c => c.rank === rankCard.rank)); possiblePlays.push(actualStraight); } } } } const validPlays = possiblePlays.filter(play => isValidPlay(play, lastPlayedHand)); if (validPlays.length === 0) return null; validPlays.sort((a, b) => getHandType(a).value - getHandType(b).value); return validPlays[0]; }

        // --- GAME FLOW & ACTIONS ---
        function switchTurn() { currentPlayer = (currentPlayer === 'player') ? 'dealer' : 'player'; updateTurnUI(); if (currentPlayer === 'dealer' && !gameOver) { setTimeout(dealerTurn, 1500); } }
        function updateTurnUI() { turnIndicator.textContent = (currentPlayer === 'player') ? 'Bạn' : 'Đối Thủ'; playBtn.disabled = currentPlayer !== 'player'; passBtn.disabled = currentPlayer !== 'player'; sortBtn.disabled = currentPlayer !== 'player'; }
        function playCards(cards, player) { if (player === 'player') { playerHand = playerHand.filter(card => !cards.some(c => c.value === card.value)); renderHand(); } else { dealerHand = dealerHand.filter(card => !cards.some(c => c.value === card.value)); renderOpponentHand(); } sortHand(cards); renderPlayArea(cards); lastPlayedHand = cards; consecutivePasses = 0; lastActionEl.textContent = `${player === 'player' ? 'Bạn' : 'Đối Thủ'} đánh ${cards.length} lá.`; if (checkWin()) return; switchTurn(); }
        function handlePlayCards() { sortHand(selectedCards); if (!isValidPlay(selectedCards, lastPlayedHand)) { showAlert("Nước đi không hợp lệ!"); return; } playCards(selectedCards, 'player'); selectedCards = []; }
        function handlePassTurn() { if (lastPlayedHand.length === 0) { showAlert("Bạn phải đánh bài vì đây là vòng mới!"); return; } consecutivePasses++; lastActionEl.textContent = `Bạn bỏ lượt.`; if (consecutivePasses >= 1) { lastPlayedHand = []; lastActionEl.textContent += ` Vòng mới bắt đầu.`; } selectedCards = []; renderHand(); switchTurn(); }
        function dealerTurn() { const play = findDealerPlay(); if (play) { playCards(play, 'dealer'); } else { consecutivePasses++; lastActionEl.textContent = `Đối thủ bỏ lượt.`; if (consecutivePasses >= 1) { lastPlayedHand = []; lastActionEl.textContent += ` Vòng mới bắt đầu.`; } switchTurn(); } }
        function checkWin() { if (playerHand.length === 0) { endGame('player'); return true; } if (dealerHand.length === 0) { endGame('dealer'); return true; } return false; }
        function endGame(winner) { gameOver = true; if (winner === 'player') { balance += currentBet * 2; winnerMessageEl.textContent = `Bạn đã thắng (+${formatCurrency(currentBet * 2)})!`; } else { winnerMessageEl.textContent = 'Bạn đã thua!'; } updateBalanceUI(); gameOverOverlay.classList.remove('hidden'); }
        function handleSortCards() { sortHand(playerHand); renderHand(); }
        function handleCardClick(cardEl, card) { const index = selectedCards.findIndex(sc => sc.value === card.value); if (index > -1) { selectedCards.splice(index, 1); cardEl.classList.remove('selected'); } else { selectedCards.push(card); cardEl.classList.add('selected'); } }
        
        function handlePlaceBet() {
            const betValue = parseInt(betAmountInput.value);
            if (isNaN(betValue) || betValue <= 0) { showAlert("Vui lòng nhập số tiền cược hợp lệ."); return; }
            if (betValue > balance) { showAlert("Số dư không đủ."); return; }
            currentBet = betValue;
            balance -= currentBet;
            updateBalanceUI();
            bettingOverlay.classList.add('hidden');
            startGame();
        }

        // --- INITIALIZE ---
        function startGame() {
            gameOver = false; lastPlayedHand = []; selectedCards = []; consecutivePasses = 0;
            gameOverOverlay.classList.add('hidden');
            const deck = createDeck(); shuffleDeck(deck); dealCards(deck); sortHand(playerHand); sortHand(dealerHand);
            const playerHas3Spades = playerHand.some(c => c.rank === '3' && SUITS[c.suit] === 'spades');
            currentPlayer = playerHas3Spades ? 'player' : 'dealer';
            renderHand(); renderOpponentHand(); renderPlayArea([]); updateTurnUI();
            if (currentPlayer === 'dealer') { lastActionEl.textContent = 'Đối thủ có 3 Bích và đi trước.'; setTimeout(dealerTurn, 1500); } 
            else { lastActionEl.textContent = 'Bạn có 3 Bích, hãy đi trước.'; }
        }

        document.addEventListener('DOMContentLoaded', () => {
            playBtn.addEventListener('click', handlePlayCards);
            sortBtn.addEventListener('click', handleSortCards);
            passBtn.addEventListener('click', handlePassTurn);
            newGameBtn.addEventListener('click', showBettingModal);
            customAlertOkBtn.addEventListener('click', () => customAlertOverlay.classList.add('hidden'));
            placeBetBtn.addEventListener('click', handlePlaceBet);
            showBettingModal();
        });
    </script>
</body>
</html>

