<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Roulette - Mẫu</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #0d0e1b;
            color: #e0e0e0;
            overflow: hidden;
        }
        .game-container {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 2rem;
            padding: 2rem;
            height: 100vh;
        }
        .game-table {
            background: radial-gradient(circle, #004b23 0%, #00210f 100%);
            border: 8px solid #5a3a22;
            position: relative;
            overflow: hidden;
            border-radius: 10px;
        }
        .table-logo {
            position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%) rotate(-15deg);
            font-size: 6vw; font-weight: 900;
            color: rgba(128, 128, 128, 0.07);
            z-index: 0; pointer-events: none; white-space: nowrap;
        }
        .table-logo span { color: rgba(255, 196, 0, 0.08); }
        
        /* Roulette Wheel Enhancements */
        .wheel-container {
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
        }
        .roulette-wheel {
            position: relative; width: 400px; height: 400px;
            border-radius: 50%;
            background: radial-gradient(circle, #333 0%, #111 100%);
            border: 15px solid #c9a227;
            box-shadow: 0 0 30px rgba(0,0,0,0.8), inset 0 0 25px rgba(0,0,0,0.9);
            display: flex; align-items: center; justify-content: center;
        }
        .wheel-inner {
            position: absolute; width: 90%; height: 90%;
            border-radius: 50%;
            background: conic-gradient(from 90deg, #222, #333, #222);
            transition: transform 6s cubic-bezier(0.15, 0.5, 0.25, 1);
        }
        .number {
            position: absolute;
            width: 50%; height: 50%;
            left: 50%; top: 50%;
            transform-origin: 0% 0%;
            font-weight: bold; font-size: 16px;
            display: flex; align-items: center; justify-content: flex-end;
            padding-right: 8px; color: white;
            text-shadow: 0 0 2px black;
        }
        .number span {
            transform: rotate(180deg);
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .number::after { /* Divider lines */
            content: '';
            position: absolute;
            right: 0; top: 0; bottom: 0;
            width: 1px;
            background: rgba(255, 255, 255, 0.1);
        }
        .ball {
            position: absolute; top: 25px; left: 50%;
            transform: translateX(-50%);
            width: 20px; height: 20px;
            background: radial-gradient(circle at 30% 30%, #ffffff, #e0e0e0);
            border-radius: 50%;
            box-shadow: 0 0 15px white, inset 0 0 3px rgba(0,0,0,0.5);
            z-index: 10;
        }
        @keyframes ball-settle {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-3px); }
        }
        .ball.settled {
            animation: ball-settle 0.5s ease-in-out 3;
        }
        .wheel-center {
            position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            width: 80px; height: 80px;
            background: radial-gradient(circle, #ffe070, #a08030);
            border-radius: 50%;
            border: 5px solid #504010;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
        }
        .result-display {
            margin-top: 1.5rem; background: #1a1c33; padding: 1rem 2rem;
            border-radius: 10px; font-size: 2rem; font-weight: 900;
            border: 2px solid #ffc400;
            min-height: 70px; text-align: center;
        }
        
        /* Betting Table */
        .betting-table-grid { display: grid; grid-template-columns: auto repeat(12, 1fr); gap: 4px; padding: 10px; }
        .bet-spot {
            background-color: #006432; border: 1px solid #004b23;
            height: 60px; display: flex; align-items: center; justify-content: center;
            font-weight: bold; font-size: 1.25rem;
            cursor: pointer; transition: background-color 0.2s;
            position: relative;
        }
        .bet-spot.red { background-color: #d62828; }
        .bet-spot.black { background-color: #111; }
        .bet-spot.zero { background-color: #008000; grid-column: 1 / 2; grid-row: 1 / 4; }
        .bet-spot:hover { background-color: #008f48; }
        .bet-spot.red:hover, .bet-spot.black:hover { opacity: 0.8; }
        .placed-chip {
            position: absolute; width: 30px; height: 30px;
            border-radius: 50%; display: flex; justify-content: center; align-items: center;
            font-size: 10px; font-weight: bold; color: black;
            box-shadow: 0 2px 4px rgba(0,0,0,0.5);
            pointer-events: none;
        }

        /* Controls & Info */
        .controls-info { padding: 1rem; display: flex; flex-direction: column; justify-content: space-between; }
        .info-panel { background: #1a1c33; padding: 1rem; border-radius: 10px; text-align: center; }
        .chip-rack { display: flex; justify-content: center; gap: 10px; margin-top: 1rem; }
        .chip {
            width: 50px; height: 50px; border-radius: 50%;
            display: flex; justify-content: center; align-items: center;
            font-weight: bold; cursor: pointer;
            border: 3px solid #ccc;
            transition: all 0.2s ease-out;
        }
        .chip.selected { border-color: #ffc400; transform: scale(1.1); }
        .action-buttons { display: grid; grid-template-columns: 1fr 2fr; gap: 1rem; margin-top: 1rem; }
        .btn { padding: 1rem; border-radius: 8px; font-weight: bold; text-align: center; cursor: pointer; transition: all 0.2s; }
        .btn-spin { background-color: #ffc400; color: #1a1c33; font-size: 1.5rem; }
        .btn-spin:hover { background-color: #ffda59; }
        .btn-clear { background-color: #d62828; }
        .btn:disabled { background-color: #555; cursor: not-allowed; }
        #home-btn { position: absolute; top: 2rem; left: 2rem; z-index: 25; background-color: #1a1c33; color: #ffc400; padding: 0.75rem 1.5rem; border-radius: 0.5rem; font-weight: 700; text-decoration: none; border: 2px solid #ffc400; }
    </style>
</head>
<body class="bg-primary">
    <a href="index.html" id="home-btn">Về Trang Chủ</a>
    <div class="game-container">
        <div class="wheel-container">
            <div class="roulette-wheel">
                <div class="wheel-inner"></div>
                <div class="ball"></div>
                <div class="wheel-center"></div>
            </div>
            <div id="result-display" class="result-display">CHỜ QUAY</div>
            <div class="controls-info">
                <div class="info-panel">
                    <div class="text-lg">Số dư: <span id="balance-display" class="font-bold text-accent"></span></div>
                    <div class="text-lg mt-2">Tổng cược: <span id="total-bet-display" class="font-bold text-accent"></span></div>
                    <div class="chip-rack"></div>
                    <div class="action-buttons">
                        <button id="clear-btn" class="btn btn-clear">XÓA CƯỢC</button>
                        <button id="spin-btn" class="btn btn-spin">QUAY</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="game-table">
            <div class="table-logo"><span>Greenwich88</span>.bet</div>
            <div class="betting-table-grid"></div>
        </div>
    </div>
    
    <script>
        // --- GAME CONFIG ---
        const NUMBERS = [0, 32, 15, 19, 4, 21, 2, 25, 17, 34, 6, 27, 13, 36, 11, 30, 8, 23, 10, 5, 24, 16, 33, 1, 20, 14, 31, 9, 22, 18, 29, 7, 28, 12, 35, 3, 26];
        const REDS = [1, 3, 5, 7, 9, 12, 14, 16, 18, 19, 21, 23, 25, 27, 30, 32, 34, 36];
        const CHIP_VALUES = [1000, 5000, 10000, 50000, 100000];
        const CHIP_COLORS = { 1000: '#fff', 5000: '#d62828', 10000: '#0077b6', 50000: '#52b788', 100000: '#111' };
        const PAYOUTS = { number: 35, dozen: 2, range: 1, color: 1, evenodd: 1 };
        
        // --- GAME STATE ---
        let balance = 1250000;
        let selectedChip = CHIP_VALUES[0];
        let currentBets = {};
        let lastBets = {};
        let isSpinning = false;
        
        // --- DOM ELEMENTS ---
        const wheelInner = document.querySelector('.wheel-inner');
        const ball = document.querySelector('.ball');
        const bettingGrid = document.querySelector('.betting-table-grid');
        const chipRack = document.querySelector('.chip-rack');
        const balanceDisplay = document.getElementById('balance-display');
        const totalBetDisplay = document.getElementById('total-bet-display');
        const resultDisplay = document.getElementById('result-display');
        const spinBtn = document.getElementById('spin-btn');
        const clearBtn = document.getElementById('clear-btn');

        // --- SETUP FUNCTIONS ---
        function createWheel() {
            wheelInner.innerHTML = ''; // Clear previous
            NUMBERS.forEach((num, index) => {
                const angle = (360 / NUMBERS.length) * index;
                const numberEl = document.createElement('div');
                numberEl.classList.add('number');
                let color;
                if (num === 0) color = '#00b300';
                else if (REDS.includes(num)) color = '#d62828';
                else color = '#111';

                numberEl.innerHTML = `<span style="background-color: ${color};">${num}</span>`;
                numberEl.style.transform = `rotate(${angle}deg)`;
                wheelInner.appendChild(numberEl);
            });
        }
        
        function createBettingTable() {
            let html = '';
            // Zero
            html += `<div class="bet-spot zero" data-bet-type="number" data-bet-value="0">0</div>`;
            // Numbers 1-36
            for (let i = 1; i <= 36; i++) {
                const color = REDS.includes(i) ? 'red' : 'black';
                html += `<div class="bet-spot ${color}" data-bet-type="number" data-bet-value="${i}">${i}</div>`;
            }
            // Dozens (grid-column needs to be set based on the grid structure)
            html += `<div class="bet-spot" data-bet-type="dozen" data-bet-value="1" style="grid-column: 2 / span 4">1st 12</div>`;
            html += `<div class="bet-spot" data-bet-type="dozen" data-bet-value="2" style="grid-column: 6 / span 4">2nd 12</div>`;
            html += `<div class="bet-spot" data-bet-type="dozen" data-bet-value="3" style="grid-column: 10 / span 4">3rd 12</div>`;
            // Bottom row bets
            html += `<div class="bet-spot" data-bet-type="range" data-bet-value="1-18" style="grid-column: 2 / span 2">1-18</div>`;
            html += `<div class="bet-spot" data-bet-type="evenodd" data-bet-value="even" style="grid-column: 4 / span 2">CHẴN</div>`;
            html += `<div class="bet-spot red" data-bet-type="color" data-bet-value="red" style="grid-column: 6 / span 2"></div>`;
            html += `<div class="bet-spot black" data-bet-type="color" data-bet-value="black" style="grid-column: 8 / span 2"></div>`;
            html += `<div class="bet-spot" data-bet-type="evenodd" data-bet-value="odd" style="grid-column: 10 / span 2">LẺ</div>`;
            html += `<div class="bet-spot" data-bet-type="range" data-bet-value="19-36" style="grid-column: 12 / span 2">19-36</div>`;
            
            bettingGrid.innerHTML = html;
        }

        function createChipRack() {
            CHIP_VALUES.forEach(value => {
                const chipEl = document.createElement('div');
                chipEl.className = 'chip';
                chipEl.dataset.value = value;
                chipEl.style.backgroundColor = CHIP_COLORS[value];
                chipEl.style.color = (value >= 100000) ? 'white' : 'black';
                chipEl.textContent = value >= 1000 ? `${value/1000}K` : value;
                chipEl.addEventListener('click', () => {
                    selectedChip = value;
                    document.querySelectorAll('.chip').forEach(c => c.classList.remove('selected'));
                    chipEl.classList.add('selected');
                });
                chipRack.appendChild(chipEl);
            });
            chipRack.firstChild.classList.add('selected');
        }

        // --- UI & GAME FLOW ---
        function updateUI() {
            balanceDisplay.textContent = balance.toLocaleString('vi-VN') + 'đ';
            const totalBet = Object.values(currentBets).reduce((a, b) => a + b, 0);
            totalBetDisplay.textContent = totalBet.toLocaleString('vi-VN') + 'đ';
            spinBtn.disabled = totalBet === 0 || isSpinning;
            clearBtn.disabled = totalBet === 0 || isSpinning;
        }
        
        function placeBet(e) {
            if (isSpinning) return;
            const target = e.target.closest('.bet-spot');
            if (!target) return;
            if (balance < selectedChip) { 
                alert("Không đủ số dư!"); 
                return; 
            }
            
            const type = target.dataset.betType;
            const value = target.dataset.betValue;
            const betKey = `${type}-${value}`;

            balance -= selectedChip;
            currentBets[betKey] = (currentBets[betKey] || 0) + selectedChip;
            
            drawChips();
            updateUI();
        }

        function drawChips() {
            document.querySelectorAll('.placed-chip').forEach(c => c.remove());
            for (const betKey in currentBets) {
                const parts = betKey.split('-');
                const type = parts[0];
                const value = parts.slice(1).join('-'); // FIX: Handle values with hyphens
                const spot = document.querySelector(`[data-bet-type="${type}"][data-bet-value="${value}"]`);
                if (spot) {
                    const chipEl = document.createElement('div');
                    chipEl.className = 'placed-chip';
                    const amount = currentBets[betKey];
                    let displayAmount = amount >= 1000 ? `${amount/1000}K` : amount;
                    let bgColor = '#fff';
                    for (const v of [...CHIP_VALUES].reverse()) {
                        if (amount >= v) { bgColor = CHIP_COLORS[v]; break; }
                    }
                    chipEl.style.backgroundColor = bgColor;
                    chipEl.style.color = (bgColor === '#111') ? 'white' : 'black';
                    chipEl.textContent = displayAmount;
                    spot.appendChild(chipEl);
                }
            }
        }
        
        function clearBets() {
            if (isSpinning) return;
            const totalBet = Object.values(currentBets).reduce((a, b) => a + b, 0);
            balance += totalBet;
            currentBets = {};
            drawChips();
            updateUI();
        }
        
        // --- SPIN LOGIC ---
        function spin() {
            if (isSpinning) return;
            isSpinning = true;
            lastBets = {...currentBets};
            updateUI();
            ball.classList.remove('settled');
            resultDisplay.textContent = "ĐANG QUAY...";
            
            wheelInner.style.transition = 'none';
            wheelInner.style.transform = 'rotate(0deg)';
            void wheelInner.offsetWidth;

            const winningNumber = NUMBERS[Math.floor(Math.random() * NUMBERS.length)];
            const winningIndex = NUMBERS.indexOf(winningNumber);
            const anglePerNumber = 360 / NUMBERS.length;
            
            // CORRECTED LOGIC:
            const visualIndexOffset = 3; // The empirical offset to fix visual alignment
            const correctedWinningIndex = (winningIndex + visualIndexOffset + NUMBERS.length) % NUMBERS.length;
            
            const targetAngle = 270 - (correctedWinningIndex * anglePerNumber);
            const totalAngle = 360 * 8 + targetAngle;
            
            wheelInner.style.transition = 'transform 6s cubic-bezier(0.15, 0.5, 0.25, 1)';
            wheelInner.style.transform = `rotate(${totalAngle}deg)`;

            // The payout calculation MUST use the original, non-offset winningNumber
            setTimeout(() => calculateWinnings(winningNumber), 6000);
        }

        function calculateWinnings(winningNumber) {
            ball.classList.add('settled');
            let winnings = 0;
            const isRed = REDS.includes(winningNumber);
            const isEven = winningNumber !== 0 && winningNumber % 2 === 0;

            for (const betKey in currentBets) {
                const parts = betKey.split('-');
                const type = parts[0];
                const value = parts.slice(1).join('-');
                const amount = currentBets[betKey];
                let won = false;
                
                if (type === 'number' && parseInt(value) === winningNumber) won = true;
                if (type === 'color' && value === (isRed ? 'red' : 'black') && winningNumber !== 0) won = true;
                if (type === 'evenodd' && winningNumber !== 0 && value === (isEven ? 'even' : 'odd')) won = true;
                if (type === 'range' && value === '1-18' && winningNumber >= 1 && winningNumber <= 18) won = true;
                if (type === 'range' && value === '19-36' && winningNumber >= 19 && winningNumber <= 36) won = true;
                if (type === 'dozen' && value === '1' && winningNumber >= 1 && winningNumber <= 12) won = true;
                if (type === 'dozen' && value === '2' && winningNumber >= 13 && winningNumber <= 24) won = true;
                if (type === 'dozen' && value === '3' && winningNumber >= 25 && winningNumber <= 36) won = true;
                
                if (won) {
                    winnings += amount + (amount * PAYOUTS[type]);
                }
            }
            
            let resultText = `SỐ ${winningNumber}`;
            if (winnings > 0) {
                balance += winnings;
                resultText += ` - Thắng ${winnings.toLocaleString('vi-VN')}đ`;
            } else {
                 resultText += " - Thua";
            }
            
            resultDisplay.textContent = resultText;
            currentBets = {};
            isSpinning = false;
            drawChips();
            updateUI();
        }

        // --- INITIALIZE ---
        document.addEventListener('DOMContentLoaded', () => {
            createWheel();
            createBettingTable();
            createChipRack();
            updateUI();
            
            bettingGrid.addEventListener('click', placeBet);
            spinBtn.addEventListener('click', spin);
            clearBtn.addEventListener('click', clearBets);
        });
    </script>
</body>
</html>

